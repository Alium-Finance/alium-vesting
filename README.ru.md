# Vesting contract README

Контракт предназначен для хранения информации о замороженных токенах. Контракт получает и замораживает токены из *AliumCash* согласно [схеме работы](https://docs.google.com/document/d/1dvgie9bU6u78NeAU1uVnLYlOb1FJOKC_Eb7Na0XyC54/edit#heading=h.ir3u62ss95xy).
В контракте предусмотрены 3 пула замороженных токенов с настраиваемыми графиками разморозки. Замороженные токены хранятся на адресе контракта.

## Инициализация (конструктор)

При инициализации передается следующие параметры:
 - адрес токена ERC20, который будет замораживаться (ALM),
 - адрес контракта *AliumCash*, у которого будут запрашиваться токены для заморозки,
 - адрес контракта обмена NFT, который будет обладать привилегиями заморозки токенов.

## Замораживание токенов

Для замораживания токенов предусмотрен метод **freeze(address wallet, uint256 amount, uint256 planId)**.
 - wallet: адрес номинального владельца токенов
 - amount: количество замораживаемых токенов
 - planId: номер плана заморозки [0..2]
Замораживать токены имеет право либо владелец контракта либо адрес, указанный в конструкторе (freezer).

## Разморозка и вывод токенов

Для вывода размороженных на данный момент токенов предусмотрен метод **claim(address beneficiary)**. Метод должен вызываться номинальным владельцем токенов,
в контракте просматриваются локи по адресу msg.sender (инициатора транзакции). В параметре _beneficiary_ нужно указать кошелек, на который необходимо вывести
токены. При успешном выводе токенов метод возвратит true, при неуспешном false. 

Для вывода токенов необходимо установить дату отсчёта разморозки методом **setReleaseTime(uint256 time)**. В параметрах необходимо указать время начала 
отсчета периода разморозки в формате Unix timestamp (кол-во секунд с 01.01.1970).

## Планы заморозки локов

При заморозке токенов указывается номер пула, из которого берется план разморозки токенов. План состоит из произвольного количества точек разморозки, каждая
точка разморозки характеризуется периодом заморозки в секундах и процентом (1..100) замороженных токенов.

Для установки плана разморозки предусмотрен привилегированный метод **addLockPlan(uint256 planId, uint256[] percents, uint256[] times)**.
Предыдущий план разморозки удаляется полностью.

Пример подготовленных параметров (примем план разморозки каждую неделю по 25%, начиная с даты разморозки):
 - массив _percents_: [ 25, 25, 25, 25 ],
 - массив _times_: [ 60 * 60 * 24 * 7, 60 * 60 * 24 * 14, 60 * 60 * 24 * 21, 60 * 60 * 24 * 28 ]
                                                                                                         
## Получение информации по кошельку

Для получения баланса по кошельку используется метод **getBalanceOf(address beneficiary)**, который возвращает массив из 2 чисел:
 - totalBalance (количество начисленных токенов)
 - unlockedBalance (количество размороженных токенов)

## Специальные роли
В контракте предусмотрено использование 2 специальных ролей: администратор (владелец) и freezerRole (право заморозки токенов).

### Owner (Admin)
Администратор может выполнять все привилегированные методы. Кроме того, администратор может поменять адрес freezerRole в любой момент.

### Freezer
Привилегия Freezer даёт возможность владельцу выполнять заморозку токенов.

## Получение информации о локах
Для получения информации о планах заморозки, предусмотрены следующие методы:

Для любого кошелька:

 - **getLockPlanLen(uint256 planId)**: вернуть количество записей заморозки для указанного плана
 - **getLockPlans(uint256 planId, uint256 idx)**: вернуть запись плана разморозки с индексом idx (idx исчисляется с 0 и должен быть меньше общего числа записей в плане разморозки)
 - **getNextUnlock()**: возвращает ближайшую дату и количество следующей порции разморозки токенов

Для привилегированного кошелька (администратора):
 - **getNextUnlock(uint256 planId)**: возвращает ближайшую дату и общее количество следующей порции разморозки токенов для указанного плана

## Safety: перевод произвольных токенов ERC20, попавших на адрес контракта
Для перевода произвольных токенов ERC20, случайно попавших на адрес контракта, предусмотрен метод 
**transferAnyERC20Token(token, wallet, amount)**. Замороженные токены этим методом переводить нельзя.
